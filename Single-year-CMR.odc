#--- OpenBUGS script for single-year capture-mark-recapture model of Johnson (2022) ---#

list(N=c(29,28,30,19,8,28,1,1,7,24,9,2,0,1,2)) #initial values

Model{

	#Detection part of model
	
	a.p~dnorm(0,1) #specifies interecept for detection probability
	b.B ~ dnorm(0,1)#l(,0) #effect of capture on detection probability 
	s.j.p ~ dunif(0,1) #standard deviation of detection probablity among j surveys
	tau.j.p <- pow(s.j.p,-2) #tau converts standard deviation to precision (i.e. tau = 1/sd^2)

	for (j in 1:n.surveys) { #n.surveys = 3
		re.j.p[j] ~ dnorm(0,tau.j.p) #assigns survey (j) as a random effect on detection probability
		logit(c[j]) <- a.p+re.j.p[j] #capture probability (c)
		logit(p[j]) <- logit(c[j])+b.B #recapture probability (p)
	}

	#Abundance part of model
	
	for(i in 1:n.transects){ #n.transects = 15
		a.n[i] ~ dnorm(0,0.1) 
		log(mu[i]) <- a.n[i] 
		N[i] ~ dpois(mu[i]) #specifies prior distribution of frog abundance across i transects as a Poisson distribution
	
		U[i,1] <- N[i] #initially all individual frogs are unmarked
		M[i,1] <- 0    #initially no individuals are marked
	
		for(j in 1:n.surveys){ #for each sampling occasion
			u[i,j] ~ dbin(c[j],U[i,j]) #sample capture probability (c) as N (new individuals) captured from the total number of unmarked individuals 
			m[i,j] ~ dbin(p[j],M[i,j]) #sample recapture probability (p) as N (marked individuals) captred from the total number of marked individuals
			U[i,j+1] <- U[i,j]-u[i,j]
			M[i,j+1] <- M[i,j] + u[i,j]
		}
	}
	logit(c.ave) <- a.p #average capture probability
	logit(p.ave) <- a.p+b.B #average recapture probability
}


